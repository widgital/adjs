<!DOCTYPE html>

<html>
<head>
  <title>base.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="slot.html">
                slot.coffee
              </a>
            
              
              <a class="source" href="ad_request.html">
                ad_request.coffee
              </a>
            
              
              <a class="source" href="advertiser.html">
                advertiser.coffee
              </a>
            
              
              <a class="source" href="base.html">
                base.coffee
              </a>
            
              
              <a class="source" href="config.html">
                config.coffee
              </a>
            
              
              <a class="source" href="endpoint.html">
                endpoint.coffee
              </a>
            
              
              <a class="source" href="engagement.html">
                engagement.coffee
              </a>
            
              
              <a class="source" href="event.html">
                event.coffee
              </a>
            
              
              <a class="source" href="page.html">
                page.coffee
              </a>
            
              
              <a class="source" href="sizes.html">
                sizes.coffee
              </a>
            
              
              <a class="source" href="utils.html">
                utils.coffee
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>base.coffee</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>uuid = <span class="hljs-built_in">require</span> <span class="hljs-string">'node-uuid'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p><a href="./utils.html">Utils</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>utils = <span class="hljs-built_in">require</span> <span class="hljs-string">'./utils'</span>
<span class="hljs-built_in">module</span>.exports = <span class="hljs-keyword">do</span> <span class="hljs-function"><span class="hljs-params">()</span>-&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>base class to handle objects - partially based off of backbone models</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Base</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>create object all iherited class constructors should call super otherwise youll have a bad time</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attribute">constructor</span>:<span class="hljs-function"><span class="hljs-params">()</span>-&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>a unique identifier for the object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-property">@id</span> = uuid.v4()</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>attributes this should not be accessed directly</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-property">@attributes</span> ||= {}</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>the list of attached events  - the only event is change</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-property">@_events</span> = []</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>dirty list of attributes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-property">@_dirty</span> = {}</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>this is very similar functionally to Backbone.model obj.set({key:val},{silent:true})</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attribute">set</span>:<span class="hljs-function"><span class="hljs-params">(attrs,options={})</span>-&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>this is to prevent the programmer from thinking this would work</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">throw</span> <span class="hljs-string">"attrs must be an object"</span> <span class="hljs-keyword">unless</span> <span class="hljs-keyword">typeof</span> attrs == <span class="hljs-string">"object"</span>
      changedAttributes = []
      <span class="hljs-keyword">for</span> k,v <span class="hljs-keyword">of</span> attrs
        <span class="hljs-keyword">if</span> <span class="hljs-property">@attributes</span>[k] != v
          changedAttributes.push k</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>set dirty attributes with new value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-property">@_dirty</span>[k]=v
          <span class="hljs-property">@attributes</span>[k] = v</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>if silent is set don’t call the change event</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> !options.silent &amp;&amp; changedAttributes.length&gt;<span class="hljs-number">0</span>
        f.apply(@,[@,changedAttributes]) <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> <span class="hljs-property">@_events</span></pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>change function pass in a function you want to add on change event</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attribute">change</span>:<span class="hljs-function"><span class="hljs-params">(f)</span>-&gt;</span>
      <span class="hljs-keyword">if</span> f <span class="hljs-keyword">and</span> <span class="hljs-keyword">typeof</span> f == <span class="hljs-string">"function"</span>
        <span class="hljs-property">@_events</span>.push f
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">unless</span> f
        f.apply(@,arguments) <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> <span class="hljs-property">@_events</span></pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>not sure about this feel like this functionality should be encapsulated but would need to encapsulate syncing…</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attribute">_cleanDirty</span>:<span class="hljs-function"><span class="hljs-params">()</span>-&gt;</span>
      <span class="hljs-property">@_dirty</span> = {}</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>returns the delta and cleans out dirty it also includes the list of constant fields if they are defined
this is useful if you want to always pass id type fields</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attribute">changedFields</span>:<span class="hljs-function"><span class="hljs-params">()</span>-&gt;</span>
      params = {}
      <span class="hljs-keyword">for</span> k,v <span class="hljs-keyword">of</span> <span class="hljs-property">@_dirty</span>
        params[k] = v
      <span class="hljs-keyword">if</span> <span class="hljs-property">@constantFields</span>
        <span class="hljs-keyword">for</span> field <span class="hljs-keyword">in</span> <span class="hljs-property">@constantFields</span>
          params[field] = <span class="hljs-property">@attributes</span>[field] <span class="hljs-keyword">if</span> <span class="hljs-property">@attributes</span>[field]
      <span class="hljs-property">@_cleanDirty</span>()
      params</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>returns the object as a querystring</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attribute">serialize</span>:<span class="hljs-function"><span class="hljs-params">()</span>-&gt;</span>
      utils.toQuery(<span class="hljs-property">@attributes</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>sets the object from a given query string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attribute">deserialize</span>:<span class="hljs-function"><span class="hljs-params">(str)</span>-&gt;</span>
      <span class="hljs-property">@set</span>(utils.fromQuery(str),<span class="hljs-attribute">silent</span>:<span class="hljs-literal">true</span>)</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
